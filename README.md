# gen-cobra-flags

A code generator for automatically creating Cobra command flags from Go struct definitions. Works seamlessly with `go generate`.

## Installation

```bash
go install github.com/gocloud9/gen-cobra-flags@latest
```

## Usage

### Basic Usage

Define a struct with struct tags for flag configuration:

```go
package example

//go:generate gen-cobra-flags -input config.go -struct Config -output flags_gen.go -package example

type Config struct {
    Host     string `flag:"host" short:"H" usage:"Server host" default:"localhost"`
    Port     int    `flag:"port" short:"p" usage:"Server port" default:"8080"`
    Debug    bool   `flag:"debug" short:"d" usage:"Enable debug mode"`
    Verbose  bool   `flag:"verbose" short:"v" usage:"Enable verbose logging"`
    LogLevel string `flag:"log-level" short:"l" usage:"Log level" default:"info"`
}
```

Run `go generate`:

```bash
go generate ./...
```

This generates a `flags_gen.go` file with a function to add flags to your Cobra command:

```go
// Code generated by gen-cobra-flags. DO NOT EDIT.
package example

import (
    "github.com/spf13/cobra"
)

func AddConfigFlags(cmd *cobra.Command, config *Config) {
    cmd.Flags().StringVarP(&config.Host, "host", "H", "localhost", "Server host")
    cmd.Flags().IntVarP(&config.Port, "port", "p", 8080, "Server port")
    cmd.Flags().BoolVarP(&config.Debug, "debug", "d", false, "Enable debug mode")
    cmd.Flags().BoolVarP(&config.Verbose, "verbose", "v", false, "Enable verbose logging")
    cmd.Flags().StringVarP(&config.LogLevel, "log-level", "l", "info", "Log level")
}
```

Use the generated function in your Cobra command:

```go
package main

import (
    "fmt"
    "github.com/spf13/cobra"
)

func main() {
    config := &Config{}
    
    cmd := &cobra.Command{
        Use:   "myapp",
        Short: "My application",
        Run: func(cmd *cobra.Command, args []string) {
            fmt.Printf("Host: %s, Port: %d\n", config.Host, config.Port)
        },
    }
    
    // Add generated flags
    AddConfigFlags(cmd, config)
    
    cmd.Execute()
}
```

## Struct Tags

The following struct tags are supported:

- `flag` - The name of the flag (default: lowercase field name)
- `short` - Short flag alias (single character)
- `usage` - Help text for the flag
- `default` - Default value for the flag

## Supported Types

- `string`
- `int`
- `bool`
- `[]string` (string slices)

## Command Line Flags

```
-input string
      Input file containing struct definition
-output string
      Output file for generated code (default "flags_gen.go")
-package string
      Package name for generated code
-struct string
      Name of the struct to generate flags for
```

## Example

See the [example](./example) directory for a complete working example.

To run the example:

```bash
cd example/demo
go build -o demo .
./demo --help
./demo -H localhost -p 9090 -d -v -l debug
```

## License

MIT